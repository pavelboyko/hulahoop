{% extends "mpa/base.html" %}
{% load humanize %}

{% block title %}{{ issue }} • {{ project.name }}{% endblock title %}

{% block breadcrumb %}
<li class="breadcrumb-item">
    <a href="{% url 'project_detail' project.id %}">
        {{ project.name | truncatechars:40 }}
    </a>
</li>
<li class="breadcrumb-item">
    <a href="{% url 'issue_list' project.id %}">
        Issues
    </a>
</li>
<li class="breadcrumb-item active" aria-current="page">
    {{ issue }}
</li>
{% endblock breadcrumb%}

{% block header %}
<div class="page-header" style="width: 100%">
    <div hx-target="this" hx-swap="outerHTML">
        {% if issue.name %}
            {{ issue.name }}
            <button hx-get="{% url 'issue_edit' project.id issue.id %}" class="btn btn-light">
                <i class="bi bi-pencil"></i>
            </button>
        {% else %}
            <button hx-get="{% url 'issue_edit' project.id issue.id %}" class="btn btn-primary">
                <i class="bi bi-pencil"></i> Name this issue
            </button>
        {% endif %}
    </div>
</div>
{% endblock header %}

{% block header-buttons %}
    
    <!--
    <button href="#" class="btn btn-outline-secondary me-1">
        <i class="bi bi-x-lg"></i> Mute
    </button>
    <button href="#" class="btn btn-success">
        <i class="bi bi-check-lg"></i> Resolve
    </button>
    -->
{% endblock header-buttons %}

{% block subheader %}
<div class="text-muted mb-2">
<span class="badge bage-bg-{{ issue.get_status_display|lower }}">
        {{ issue.get_status_display }}
</span>
    First seen {{ issue.created_at | naturaltime }}
    • Last seen {{ issue.updated_at | naturaltime }}
</div>
{% endblock subheader %}

{% block tabs %}
<ul class="nav topnav">
    <li class="nav-item">
        <a class="nav-link active" aria-current="page" href="#">
            Examples 
            <span class="badge bg-light text-dark">
            {{ issue.example_count | intcomma }}
            </span>
        </a>
    </li>
    <!--
    <li class="nav-item">
        <a class="nav-link" href="#">Activity</a>
    </li>
    -->
</ul>
{% endblock tabs %}

{% block main %}
<div class="row">
    <div style="width: 300px">
        <div class="mb-3 border-bottom">
        <h6>Last 30 days</h6>
        <div style="margin-top: -50px; margin-bottom: -20px;">
        {{ examples_last_30_days | safe}}
        </div>
        </div>

        <div class="mb-3">
        <h6>Tags</h6>
        {% for key, value in tag_count.items %}
        <p>
        {{ key }}
        <ul>
            {% for x in value %}
            <li>{{ x.value }}: {{ x.share }}%</li>
            {% endfor %}
        </ul>
        </p>
        {% endfor %}
        </div>
    </div>

    <div class="col">
    {% include 'mpa/example/list_main.html' %}
    </div>
</div>
{% endblock main %}