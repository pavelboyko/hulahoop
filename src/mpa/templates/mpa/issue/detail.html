{% extends "mpa/base.html" %}
{% load humanize %}
{% load crispy_forms_tags %}

{% block title %}{{ issue }} • {{ project.name }}{% endblock title %}

{% block breadcrumb %}
<li class="breadcrumb-item">
    <a href="{% url 'project_detail' project.id %}">
        {{ project.name | truncatechars:40 }}
    </a>
</li>
<li class="breadcrumb-item">
    <a href="{% url 'issue_list' project.id %}">
        Issues
    </a>
</li>
<li class="breadcrumb-item active" aria-current="page">
    {{ issue }}
</li>
{% endblock breadcrumb%}

{% block header %}
<div class="page-header d-flex" style="width: 100%">
    <div hx-target="this" hx-swap="outerHTML">
        {% if issue.name %}
            {{ issue.name }}
            <button hx-get="{% url 'issue_edit' project.id issue.id %}" class="btn btn-light">
                <i class="bi bi-pencil"></i>
            </button>
        {% else %}
            <button hx-get="{% url 'issue_edit' project.id issue.id %}" class="btn btn-primary">
                <i class="bi bi-pencil"></i> Name this issue
            </button>
        {% endif %}
    </div>
    <div class="ms-auto">
        <button href="#" class="btn btn-outline-secondary me-1">
            <i class="bi bi-x-lg"></i> Mute
        </button>
        <button href="#" class="btn btn-success">
            <i class="bi bi-check-lg"></i> Resolve
        </button>
    </div>
</div>
{% endblock header %}

{% block header-buttons %}    
{% endblock header-buttons %}

{% block subheader %}
<div class="text-muted mb-2">
<span class="badge bage-bg-{{ issue.get_status_display|lower }}">
        {{ issue.get_status_display }}
</span>
    First seen {{ issue.first_seen | naturaltime }}
    • Last seen {{ issue.last_seen | naturaltime }}
</div>
{% endblock subheader %}

{% block tabs %}
<ul class="nav topnav">
    <li class="nav-item">
        <a class="nav-link active" aria-current="page" href="#">
            Examples 
        </a>
    </li>
</ul>
{% endblock tabs %}

{% block main %}
<div class="row" class="mx-0">
    <form method="get" novalidate>
        <div class="row align-items-end">
            <div style="width: 300px">
                {{ filter.form.created_at | as_crispy_field }}
            </div>
            <div class="col">
                {{ filter.form.search | as_crispy_field }}
            </div>
        </div>
    </form>
</div>
<div class="row">
{% if examples_page %}
    <div style="width: 300px">
        {% include 'mpa/issue/detail_panel.html' %}
    </div>
    <div class="col">          
        {% include 'mpa/example/list_main.html' with page=examples_page total_count=example_count%}
    </div>
{% else %}
<p class="text-center">
{% if filter.search_error_message %}
<span class="text-danger">
{{ filter.search_error_message }}
</span>
{% else %}
No examples found.
{% endif %}
</p>
{% endif %}
</div>
{% endblock main %}
